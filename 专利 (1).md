# 1、基于webrtc的p2p和sfu混合传输架构

- WebRTC 在构建浏览器视频会话的时候，肯定少不了服务器的支持。目前，WebRTC 主要有三种网络架构：Mesh、MCU、SFU。
- **P2P**（点对点/网状）
- **SFU**（选择性转发单元）

### SFU（选择性转发单元）

这种架构是最近视频会议解决方案的主要选择。有中央[SFU媒体服务器](https://www.ctyun.cn/portal/link.html?target=https%3A%2F%2Fbloggeek.me%2Fwebrtc-multiparty-video-alternatives%2F)接收已发布的流，然后将它们路由而不修改它们到其他参与者。

虽然显然一些复杂性转移到服务器端，但它比P2P有了巨大的改进，因为它解决了**P2P**遭受的上传带宽和可扩展性问题。

**联播**通常与SFU（选择性转发单元）一起使用，其中每个参与者将其流的多个版本发布到**SFU**（选择性转发单元），每个版本具有不同的质量。然后**SFU**（选择性转发单元）决定将低质量的流版本路由到互联网连接不佳的参与者。或者，仅当参与者在本地最大化流时，才提供流的高质量版本。

这样就可以节省大量的下行链路带宽，即使参与者的平均互联网连接，许多参与者也可以显示在同一网格中。

### **P2P**（点对点）![img](https://ctyun-developers-0510.gdoss.xstore.ctyun.cn/prod/96465138d0d24b53959bce4e1b40f575.png)

**P2P**（点对点）有时也称为**网状**架构。 这是最基本的架构，很容易推理。会议中的每个参与者都是对等方，并通过与每个对等方建立对等连接将其视频/音频发送给所有其他对等方。



![img](https://ctyun-developers-0510.gdoss.xstore.ctyun.cn/prod/ad68e6e24558490d9f115667377c16c1.png)

## 一、专利名称

基于WebRTC的P2P和SFU混合传输架构

## 二、所属技术领域

在构建实时视频流通信时，WebRTC（Web实时通信）技术提供了网络传输架构。该专利涉及基于WebRTC技术的传输架构，结合了点对点（P2P）和选择性转发单元（SFU）的混合模式。

WebRTC是一种用于在Web浏览器之间进行实时音视频和数据传输的开放标准，它使用了一系列的协议和技术，如实时传输协议（RTP）、会话描述协议（SDP）和候选者协议（ICE）等。

当单独采用Mesh 服务器架构其实就是标准 P2P 通讯模式时，其优点是这种架构对服务器占用资源最小，网络状况好，但是另一方面也分配了更多的端口，消耗更多的系统资源，增加了上行网络带宽的消耗。

在引入SFU（选择性转发单元）的混合传输架构中，SFU充当了一个中间节点，负责接收来自发送方的数据流，并根据网络条件和设备能力选择性地转发给接收方。SFU在传输过程中可以对数据流进行处理和转码，以适应不同的网络环境和接收方的设备能力。



## 三、现有的技术方案

在现有的实时视频流通信方案中，WebRTC 在构建浏览器视频通信时，提出的网络架构方案可分为Mesh（P2P）服务器架构，Multi-point Control Unit（MCU）服务器架构和Selective Forwarding Unit（SFU）服务器架构。

1、Mesh 服务器架构其实就是标准 P2P 通讯模式的混用，每一个 P2P 连接有独立的传输策略控制，在Mesh架构中，每个参与者都可以同时与其他所有参与者进行直接通信，实现实时视频流的传输。因为这种架构需要分配更多的端口，消耗更多的系统资源，因此Mesh比较适合网络状况较好，人数较少，比如一对一的场景中。

2、MCU传输方案中，参与者通过与MCU建立连接来实现实时视频流的传输。MCU充当中间节点，负责接收来自发送方的数据流，并根据需要选择性地转发给接收方。MCU可以进行混音、混频和转码等处理，以适应不同的网络环境和设备能力。这种方案可以提供更好的可扩展性和灵活性，但也存在单点故障和传输延迟的问题。

3、SFU 传输方案是一种折中的方案，结合了P2P和MCU的优势。在SFU传输中，每个参与者与SFU建立连接，SFU接收来自发送方的数据流，并根据网络条件和接收方的设备能力选择性地将数据流转发给合适的接收方，这使得SFU可以以最低的开销来转发各路媒体流。此外，SFU可以根据需要进行转码和处理，以适应不同的网络环境和设备能力。





## 四、现有技术的缺点及本提案要解决的技术问题

### 现有技术的缺点:

1、在Mesh架构中，需要为每个P2P连接分配独立的端口和系统资源，这会增加系统开销和网络负载。另外，当参与者数量较多时，由于数据流需要通过多个路径传输，Mesh架构可能导致带宽利用率不高。

2、对于MCU架构，作为中间节点，存在单点故障的风险。如果MCU发生故障，整个通信系统将无法正常工作。而且由于数据流需要经过MCU进行处理和转发，MCU架构可能引入额外的传输延迟。

3、SFU需要选择性地将数据流转发给适合的接收方，这可能引入一定的转发开销，特别是在大规模通信中

4、

5、





## 解决的问题

1、提高带宽利用率，通过智能的数据流量分配和动态的路径选择，结合混合使用P2P和SFU架构，根据通信人数的不同来适配不同的传输架构。

2、本提案通过混合使用P2P和SFU架构，避免了单点故障的问题，提供更高的可用性和稳定性。

3、通过优化数据流的传输路径和减少中间节点的处理和转发来降低传输延迟，以实现更快的实时视频流传输。这样的优化措施可以确保视频流以更快的速度到达接收方，从而提供更即时、流畅的实时视频体验。





## 五、本提案的技术方案的详细阐述

1、动态的网络结构切换技术：

在基于WebRTC的实时视频通信中，网络架构的选择对于传输效率和用户体验至关重要。采用动态的网络结构切换技术，根据通信人数的不同，在两人通信时采用P2P网络架构，而在多人通信时切换为SFU网络架构。

在双方通信时，P2P网络架构可以直接建立点对点的连接，避免了中心节点的转发，降低了传输延迟和带宽消耗。同时，P2P网络架构还具有较好的隐私性，通信数据直接传输在两个参与者之间，不经过第三方服务器，增强了数据的安全性。

而在多人通信时，SFU网络架构的优势得以发挥。SFU作为中心节点，接收来自发送方的数据流，并根据网络条件和接收方的设备能力选择性地将数据流转发给合适的接收方。SFU通过智能的路由算法和转发策略，能够提供稳定的传输质量，并具备较好的可扩展性，适应大规模的通信需求。

这种动态切换的方案能够充分利用P2P的优势，节省网络资源，并在需要时无缝切换到SFU，以适应不同规模的通信情况。

2、智能的数据流量分配技术：

为了提供高质量的视频传输，节省流量并避免带宽浪费和传输延迟，引入智能的数据流量分配技术。该技术基于通信人数、网络状况、带宽可用性等因素进行分析和决策，以实现数据流量的智能分配

在双方通信时，智能的数据流量分配技术可以根据网络状况和带宽可用性，动态调整数据流量的分配比例。例如，如果网络状况良好且带宽充足，可以增加视频数据的传输比例，提供更高清晰度的视频传输。而在网络状况不佳或带宽有限的情况下，可以减少视频数据的传输比例，以保证稳定的传输和较低的延迟。

在多人通信时，智能的数据流量分配技术可以根据参与者位置和网络状况，选择合适的SFU节点进行数据流的转发。通过智能的路由算法，可以选择距离较近且网络状况较好的节点进行转发，减少传输延迟和丢包率，提高传输质量。

智能的数据流量分配技术还可以根据参与者的设备能力和网络带宽，适应性地调整视频的编码参数，以保证流畅的传输和通信体验。

按照上述技术方案构建实时视频通信，不仅能够适应不同情况下的通信需求，还能够提供高质量的视频传输，节省流量，并避免带宽浪费和传输延迟，从而显著提升用户体验和系统性能。





## 六、本提案的技术关键点和欲保护点

本提案旨在通过智能的数据流量分配和动态的网络结构切换来优化实时视频传输。系统根据通信人数的变化，分析网络状况、带宽可用性和参与者位置等因素，合理分配数据流量，以确保每个参与者获得稳定、流畅的视频流。同时，根据通信人数的不同，系统智能地选择P2P或SFU传输架构，以提供低延迟、高效的传输和可靠的数据流转发。



## 七、与第三条中最接近的现有技术相比，本提案有何技术优点

在基于WebRTC的P2P和SFU混合传输架构上，引入智能的数据流量分配和动态的网络结构切换，不仅可以提供高质量的视频传输，还可以通过分析网络状况、带宽可用性和参与者位置等因素，来智能地分配数据流量和选择适合的传输架构，避免带宽浪费和传输延迟，从而提升用户体验和系统性能。



## 八、其他有助于理解本提案的技术资料











#  2、利用sfu在webrtc传输中实现视频运动检测与带宽优化的方法 

## 或者叫 基于webrtc的移动端视频传输系统与异常帧优先传输方法

## 一、专利名称





## 二、所属技术领域

​	在构建实时视频流通信时，数据包通过一种基于SFU（Selective Forwarding Unit）的WebRTC（Web Real-Time Communication）视频传输技术转发给接收端。

​	WebRTC是一种用于在Web浏览器之间进行实时音视频和数据传输的开放标准，它使用了一系列的协议和技术，如实时传输协议（RTP）、会话描述协议（SDP）和候选者协议（ICE）等。



## 三、现有的技术方案







## 四、现有技术的缺点及本提案要解决的技术问题

### 现有技术的缺点:







## 解决的问题







## 五、本提案的技术方案的详细阐述











## 六、本提案的技术关键点和欲保护点







## 七、与第三条中最接近的现有技术相比，本提案有何技术优点









## 八、其他有助于理解本提案的技术资料















#  专利模版1

1、专利名称

基于webrtc的p2p和sfu混合传输架构

2、所属技术领域

3、现有技术的技术方案

4、现有技术的缺点及本提案要解决的技术问题

5、本提案的技术方案的详细阐述

6、本提案的技术关键点和欲保护点

7、与第三条中最接近的现有技术相比，本提案有何技术优点

8、其他有助于理解本提案的技术资料



在引入SFU（选择性转发单元）的混合传输架构中，SFU充当了一个中间节点，负责接收来自发送方的数据流，并根据网络条件和设备能力选择性地转发给接收方。SFU在传输过程中可以对数据流进行处理和转码，以适应不同的网络环境和接收方的设备能力。

通过引入SFU，混合传输架构在P2P通信模式中增加了一个中心节点，这个节点可以智能地管理和控制数据流的转发。具体来说，当发送方与SFU建立连接后，数据流会首先传输到SFU，然后SFU会根据网络条件和接收方的设备能力，选择性地将数据流转发给合适的接收方。这种选择性转发可以基于多种因素进行决策，例如网络延迟、带宽可用性、设备处理能力等。

通过混合传输架构，P2P和SFU相互协作，共同优化实时通信的性能和可靠性。P2P模式可以充分利用直接点对点传输的高效性，尤其在网络状况良好时表现出色。而SFU模式则可以处理网络环境复杂、设备能力有限的情况，通过选择性转发和转码，提高通信质量和稳定性。

总之，本专利的创新点在于将P2P和SFU结合起来，通过智能的数据转发和动态的数据流量分配，优化了实时通信的性能和用户体验。混合传输架构利用了P2P和SFU各自的优势，提供了灵活、智能的传输方案，适应不同的网络环境和设备条件。

# 专利模版2

编写专利提案技术交底书是一项复杂的任务，需要详细描述你的技术方案以及与现有技术的区别和创新之处。以下是一个简要的技术交底书结构示例，供你参考：

1. 技术领域：介绍你的技术属于哪个领域，例如视频传输、WebRTC、SFU等。

2. 背景技术：描述现有的相关技术和问题。说明现有技术在视频传输和运动检测方面的局限性和挑战。

3. 技术问题：阐述你的技术旨在解决的问题。例如，提高视频传输的实时性和效率，实现在视频传输中的实时运动检测等。

4. 技术方案概述：总体概述你的技术方案。说明你的方案包括建立前置处理服务器、使用计算机视觉技术进行视频处理和运动检测，以及将处理后的视频流转发给SFU服务器等。

5. 技术细节：详细描述你的技术方案的各个方面，包括但不限于以下内容：
   - 前置处理服务器的架构和功能：描述前置处理服务器的组成部分、工作原理和功能，包括视频流接收、处理和转发的过程。
   - 视频处理算法：详细描述你使用的计算机视觉算法，例如运动检测算法、目标跟踪算法等。描述算法的原理、步骤和实现细节。
   - 视频流转发：说明如何使用WebRTC协议将处理后的视频流转发给SFU服务器，以及与SFU服务器的交互方式。

6. 创新性和优势：强调你的技术方案的创新性和优势，与现有技术的区别和改进之处。说明你的方案能够提供更高效、实时的视频传输和运动检测能力，以及提供更好的用户体验等。

7. 实施示例：提供一个具体的实施示例，例如基于某个开源SFU服务器的实现方案。描述实施示例的硬件和软件环境，以及实现的步骤和结果。

8. 附图和说明：附上相关的图表、流程图、示意图等，以更清晰地说明你的技术方案。对附图进行详细的说明和标注。

9. 总结：总结你的技术方案的优势和创新之处，以及所解决的问题。强调你的技术方案的商业应用和潜在的市场前景。

请注意，编写专利提案技术交底书需要符合专利申请的相关法律和规定。建议在撰写专利提案之前咨询专利律师或专业机构，以确保你的技术交底书符合专利申请的要求，并获得专业的法律指导。



# 专列二框架1

1. 所属技术领域： 本专利提案属于通信技术领域，具体是基于WebRTC的移动端视频传输系统与异常帧优先传输方法。
2. 现有的技术方案： 介绍当前已知的相关技术方案，如基于WebRTC的移动端视频传输系统、视频流中的运动检测等。说明现有技术在实际应用中的局限性和不足之处。
3. 现有技术的缺点及本提案要解决的技术问题： 详细列举现有技术的缺点，例如在视频传输过程中带宽占用较大、对异常帧的处理不够高效等。针对这些问题，提出本专利提案旨在通过利用SFU在WebRTC传输中实现视频运动检测与带宽优化，解决现有技术所面临的问题。
4. 本提案的技术方案的详细阐述： 具体描述本提案的技术方案，包括实施过程、关键步骤和相应的算法。例如，通过引入SFU（Selective Forwarding Unit）作为传输中间件，利用运动检测算法提取视频流中的关键帧，并根据优先级对包进行标记，以实现带宽优化和异常帧优先传输。
5. 本提案的技术关键点和欲保护点： 阐述本专利提案的核心技术关键点和创新之处。例如，将SFU与WebRTC结合应用于视频传输系统，利用运动检测算法进行关键帧提取和包优先级标记等。同时，明确欲保护的技术点，如具体的算法实现细节、系统架构等。

# 专列二框架2

​	我想要写个专利，大致名称还没有定，应该是利用sfu在webrtc传输中实现视频运动检测与带宽优化的方法  或者叫 基于webrtc的移动端视频传输系统与异常帧优先传输方法这种。就是视频检测加异常帧优先传输。具体技术方案应该是检测视频流中的运动的关键帧。然后在包上标记高的优先级。 专利提案中要写1.所属技术领域2.现有的技术方案3.现有技术的缺点及本提案要解决的技术问题4.本提案的技术方案的详细阐述5.本提案的技术关键点和欲保护点 帮我写个大致框架？

​	

​	







